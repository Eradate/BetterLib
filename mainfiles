local library = {}
library.__index = library

local function createInstance(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties) do
        instance[property] = value
    end
    return instance
end

function library.new(titleText)
    local lib = setmetatable({}, library)
    local screenGui = createInstance("ScreenGui", {Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")})

    local mainFrame = createInstance("Frame", {
        Size = UDim2.new(0, 225, 0, 300), -- Reduced from 300x400 to 225x300
        Position = UDim2.new(0.5, -112.5, 0.5, -150), -- Adjusted position for new size
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Color3.fromRGB(40, 40, 40),
        Parent = screenGui,
        Draggable = true,
        Active = true,
        ClipsDescendants = true
    })
    createInstance("UICorner", {CornerRadius = UDim.new(0, 10), Parent = mainFrame})

    local titleBar = createInstance("Frame", {
        Size = UDim2.new(1, 0, 0, 22), -- Reduced height from 30 to 22
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        Parent = mainFrame
    })

    local titleLabel = createInstance("TextLabel", {
        Size = UDim2.new(1, -45, 1, 0), -- Adjusted size for smaller title bar
        Position = UDim2.new(0, 7.5, 0, 0), -- Adjusted position
        Text = titleText or "Title",
        TextColor3 = Color3.fromRGB(255, 255, 255),
        TextXAlignment = Enum.TextXAlignment.Left,
        BackgroundTransparency = 1,
        Parent = titleBar
    })

    local closeButton = createInstance("TextButton", {
        Size = UDim2.new(0, 22.5, 1, 0), -- Reduced size for the close button
        Position = UDim2.new(1, -22.5, 0, 0),
        Text = "X",
        TextColor3 = Color3.fromRGB(255, 0, 0),
        BackgroundTransparency = 1,
        Parent = titleBar
    })
    closeButton.MouseButton1Click:Connect(function() screenGui:Destroy() end)

    local tabBar = createInstance("ScrollingFrame", {
        Size = UDim2.new(1, 0, 0, 22), -- Reduced height from 30 to 22
        Position = UDim2.new(0, 0, 0, 22), -- Adjusted position
        CanvasSize = UDim2.new(0, 0, 0, 22),
        ScrollBarThickness = 6, -- Reduced thickness
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        Parent = mainFrame
    })

    local tabs = {}
    local tabButtons = {}

    function lib:addTab(name)
        local tabContentFrame = createInstance("ScrollingFrame", {
            Size = UDim2.new(1, 0, 1, -44), -- Adjusted for smaller tab bar and title bar
            Position = UDim2.new(0, 0, 0, 44), -- Adjusted position
            CanvasSize = UDim2.new(0, 0, 0, 0),
            ScrollBarThickness = 6, -- Reduced thickness
            BackgroundTransparency = 1,
            ClipsDescendants = true,
            Parent = mainFrame,
            Visible = false
        })

        local tabButton = createInstance("TextButton", {
            Size = UDim2.new(0, 75, 1, 0), -- Reduced width from 100 to 75
            Position = UDim2.new(#tabs * 0.25, 0, 0, 0), -- Adjusted position
            Text = name,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundColor3 = Color3.fromRGB(60, 60, 60),
            Parent = tabBar
        })
        tabButton.MouseButton1Click:Connect(function()
            for _, tab in pairs(tabs) do
                tab.Visible = false
            end
            tabContentFrame.Visible = true
        end)

        table.insert(tabs, tabContentFrame)
        table.insert(tabButtons, tabButton)

        -- Update the tab bar canvas size to accommodate new tabs
        tabBar.CanvasSize = UDim2.new(0, 75 * #tabs, 0, 22)

        return tabContentFrame
    end

    local function adjustTabCanvasSize(tab, increment)
        tab.CanvasSize = UDim2.new(0, 0, 0, tab.CanvasSize.Y.Offset + increment)
    end

    function lib:addDropdown(tab, options)
        -- Add dropdown to specified tab
        -- Implementation remains the same
    end

    function lib:addLabel(tab, text)
        local label = createInstance("TextLabel", {
            Size = UDim2.new(1, 0, 0, 22), -- Reduced height from 30 to 22
            Text = text,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundTransparency = 1,
            Parent = tab
        })
        adjustTabCanvasSize(tab, 22) -- Reduced increment from 30 to 22
        return label
    end

    function lib:addToggle(tab, text, callback)
        local toggle = createInstance("TextButton", {
            Size = UDim2.new(1, 0, 0, 22), -- Reduced height from 30 to 22
            Text = text,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundTransparency = 1,
            Parent = tab
        })
        local toggled = false
        toggle.MouseButton1Click:Connect(function()
            toggled = not toggled
            callback(toggled)
        end)
        adjustTabCanvasSize(tab, 22) -- Reduced increment from 30 to 22
        return toggle
    end

    function lib:addTextbox(tab, placeholder, callback)
        local textbox = createInstance("TextBox", {
            Size = UDim2.new(1, 0, 0, 22), -- Reduced height from 30 to 22
            PlaceholderText = placeholder,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundTransparency = 1,
            Parent = tab
        })
        textbox.FocusLost:Connect(function(enterPressed)
            if enterPressed then
                callback(textbox.Text)
            end
        end)
        adjustTabCanvasSize(tab, 22) -- Reduced increment from 30 to 22
        return textbox
    end

    function lib:addButton(tab, text, callback)
        local button = createInstance("TextButton", {
            Size = UDim2.new(1, 0, 0, 22), -- Reduced height from 30 to 22
            Text = text,
            TextColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundTransparency = 1,
            Parent = tab
        })
        button.MouseButton1Click:Connect(function()
            callback()
        end)
        adjustTabCanvasSize(tab, 22) -- Reduced increment from 30 to 22
        return button
    end

    -- Make the mainFrame draggable
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = mainFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    mainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)

    return lib
end

return library
